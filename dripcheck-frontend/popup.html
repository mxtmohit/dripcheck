<!DOCTYPE html>
<html>
  <head>
    <title>DripCheck</title>
    <meta charset="utf-8">
    <style>
      * {
        box-sizing: border-box;
      }
      
      body { 
        margin: 0; 
        padding: 0; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: #ffffff;
        min-width: 400px;
        width: 400px;
        color: #1f2937;
        line-height: 1.5;
      }
      
      .container {
        padding: 20px;
        max-width: 100%;
      }
      
      .header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f3f4f6;
      }
      .header-top {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-bottom: 8px;
        position: relative;
      }
      
      .header-logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .logo {
        width: 20px;
        height: 20px;
        flex-shrink: 0;
        border-radius: 6px;
      }
      
      .header h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        color: #111827;
        letter-spacing: -0.025em;
      }
      
      .header .subtitle {
        margin: 4px 0 0 0;
        font-size: 13px;
        color: #6b7280;
        font-weight: 400;
      }
      
      .section { 
        background: #ffffff; 
        border: 1px solid #e5e7eb;
        border-radius: 12px; 
        padding: 18px; 
        margin-bottom: 16px; 
      }
      
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      
      .main-grid .section {
        margin-bottom: 0;
        display: flex;
        flex-direction: column;
      }
      
      .full-width {
        grid-column: 1 / -1;
      }
      
      .controls-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      .controls-row.single-preview {
        grid-template-columns: 1fr;
      }
      
      .controls-row .section {
        margin-bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      
      @media (max-width: 450px) {
        .main-grid,
        .controls-row {
          grid-template-columns: 1fr;
        }
      }
      
      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
        margin: 0 0 16px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .section-title::before {
        content: '';
        width: 4px;
        height: 16px;
        background: #3b82f6;
        border-radius: 2px;
      }
      
      #btn { 
        font-size: 14px; 
        font-weight: 600; 
        cursor: pointer; 
        border: none; 
        border-radius: 10px; 
        transition: all 0.2s ease;
        letter-spacing: -0.01em;
      }
      /* Compact round button when in header */
      .header-toggle {
        width: 44px;
        height: 44px;
        padding: 0;
        border-radius: 12px;
        margin-bottom: 0;
        font-size: 18px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.12);
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        border: 2px solid rgba(255,255,255,0.8);
      }
      .header-logout {
        height: 34px;
        padding: 0 10px;
        border-radius: 10px;
        margin-bottom: 0;
        font-size: 12px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        background: #ef4444;
        color: #ffffff;
        border: none;
        cursor: pointer;
      }
      .header-logout:hover {
        filter: brightness(0.95);
      }
      #btn.on { 
        background: #059669; 
        color: #ffffff; 
        box-shadow: 0 6px 18px rgba(5, 150, 105, 0.35), 0 0 0 3px rgba(5, 150, 105, 0.25);
      }
      #btn.off { 
        background: #dc2626; 
        color: #ffffff; 
        box-shadow: 0 6px 18px rgba(220, 38, 38, 0.35), 0 0 0 3px rgba(220, 38, 38, 0.25);
      }
      #btn:hover { 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
      }
      
      input[type="email"], input[type="password"], input[type="text"] {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
        background: #ffffff;
        margin-bottom: 12px;
        font-family: inherit;
      }
      
      input[type="file"] {
        width: 100%;
        padding: 0;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
        background: transparent;
        margin-bottom: 12px;
        font-family: inherit;
        cursor: pointer;
      }
      
      input[type="file"]::-webkit-file-upload-button {
        width: 100%;
        padding: 12px 16px;
        border: 2px dashed #d1d5db;
        border-radius: 8px;
        background: #f8fafc;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      input[type="file"]::-webkit-file-upload-button:hover {
        border-color: #3b82f6;
        background: #eff6ff;
        color: #3b82f6;
        transform: translateY(-1px);
      }
      
      input[type="file"]::-webkit-file-upload-button:active {
        transform: translateY(0);
      }
      
      /* Firefox file input styling */
      input[type="file"] {
        position: relative;
      }
      
      input[type="file"]::before {
        content: 'üìÅ Choose Image File';
        display: block;
        width: 100%;
        padding: 12px 16px;
        border: 2px dashed #d1d5db;
        border-radius: 8px;
        background: #f8fafc;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }
      
      input[type="file"]:hover::before {
        border-color: #3b82f6;
        background: #eff6ff;
        color: #3b82f6;
        transform: translateY(-1px);
      }
      
      input[type="file"]:active::before {
        transform: translateY(0);
      }
      
      /* Hide the default file input */
      input[type="file"] {
        opacity: 0;
        position: absolute;
        z-index: -1;
      }
      
      /* Custom file input wrapper */
      .file-input-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 12px;
      }
      
      .file-input-label {
        display: block;
        width: 100%;
        padding: 12px 16px;
        border: 2px dashed #d1d5db;
        border-radius: 8px;
        background: #f8fafc;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .file-input-label:hover {
        border-color: #3b82f6;
        background: #eff6ff;
        color: #3b82f6;
        transform: translateY(-1px);
      }
      
      .file-input-label:active {
        transform: translateY(0);
      }
      
      .file-input-label.has-file {
        border-color: #059669;
        background: #f0fdf4;
        color: #059669;
        border-style: solid;
      }
      
      .item-type-section {
        margin-top: 8px;
      }
      
      .item-type-label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 6px;
      }
      
      .item-type-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 13px;
        font-family: inherit;
        background: white;
        transition: all 0.2s ease;
        box-sizing: border-box;
      }
      
      .item-type-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .item-type-input::placeholder {
        color: #9ca3af;
        font-style: italic;
      }
      
      .item-type-help {
        font-size: 11px;
        color: #6b7280;
        margin-top: 4px;
        line-height: 1.4;
      }
      
      input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      input::placeholder {
        color: #9ca3af;
      }
      
      .btn-group {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
      }
      
      .btn {
        flex: 1;
        height: 40px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }
      
      .btn-primary { 
        background: #3b82f6; 
        color: #ffffff; 
        box-shadow: 0 1px 3px rgba(59, 130, 246, 0.3);
      }
      .btn-success { 
        background: #059669; 
        color: #ffffff; 
        box-shadow: 0 1px 3px rgba(5, 150, 105, 0.3);
      }
      .btn-danger { 
        background: #dc2626; 
        color: #ffffff; 
        box-shadow: 0 1px 3px rgba(220, 38, 38, 0.3);
      }
      
      .btn:hover { 
        transform: translateY(-1px); 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
      }
      
      .error-message {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #dc2626;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 13px;
        margin-bottom: 16px;
        font-weight: 500;
      }
      
      .user-info {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        color: #ffffff;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        position: relative;
      }
      
      .user-info h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
        font-weight: 700;
        letter-spacing: -0.025em;
      }
      
      .user-info .tokens {
        font-size: 14px;
        opacity: 0.9;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
      }
      
      .logout-section {
        margin-top: 20px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
        text-align: center;
      }
      
      .logout-btn {
        background: #dc2626;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
        max-width: 200px;
        box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        font-family: inherit;
      }
      
      .logout-btn:hover {
        background: #b91c1c;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
      }
      
      .logout-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
      }
      
      .refresh-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #ffffff;
        border-radius: 6px;
        padding: 4px 8px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        min-width: 28px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .refresh-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: rotate(180deg);
      }
      
      .refresh-btn:active {
        transform: rotate(180deg) scale(0.95);
      }
      
      .refresh-btn.loading {
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      .image-preview {
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 12px;
        border: 1px solid #e5e7eb;
        background: #f8fafc;
        min-height: 140px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      
      .image-preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }
      
      .image-preview img:not([src]),
      .image-preview img[src=""] {
        display: none;
      }
      
      .image-preview::after {
        content: '';
        display: block;
        width: 100%;
        height: 140px;
        background-image: url('assets/placeholder.svg');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 8px;
      }
      .image-preview.has-image::after {
        content: none;
      }
      
      .generated-section .image-preview:empty::after {
        background-image: url('assets/placeholder.svg');
        opacity: 0.7;
      }
      
      .image-controls {
        text-align: center;
        margin-bottom: 16px;
      }
      
      .image-controls .btn {
        width: auto;
        padding: 8px 16px;
        font-size: 13px;
        height: 36px;
      }
      
      .preview-comparison {
        position: relative;
      }
      
      .preview-comparison::after {
        content: '‚Üí';
        position: absolute;
        top: 50%;
        right: -8px;
        transform: translateY(-50%);
        font-size: 20px;
        color: #6b7280;
        font-weight: bold;
        z-index: 10;
        pointer-events: none;
      }
      
      .preview-comparison:last-child::after {
        display: none;
      }
      
      .status-text {
        font-size: 13px;
        color: #6b7280;
        text-align: center;
        margin-top: 12px;
        font-weight: 500;
      }
      
      .coupon-input-group {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }
      
      .coupon-input-group input {
        flex: 1;
        margin-bottom: 0;
        font-size: 13px;
        padding: 10px 12px;
      }
      
      .coupon-input-group .btn {
        height: 40px;
        font-size: 13px;
        padding: 0 16px;
        flex: none;
      }
      
      .coupon-message {
        font-size: 12px;
        text-align: center;
        font-weight: 500;
        min-height: 16px;
      }
      
      
      .download-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #059669;
        color: #ffffff;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
        transition: all 0.2s ease;
        font-family: inherit;
      }
      
      .download-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4);
      }
      
      .clear-btn {
        position: absolute;
        top: 8px;
        left: 8px;
        background: rgba(220, 38, 38, 0.9);
        color: #ffffff;
        border: none;
        border-radius: 8px;
        width: 28px;
        height: 28px;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(220, 38, 38, 0.3);
      }
      .clear-btn:hover {
        filter: brightness(0.95);
      }
      
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-top">
          <button id="logoutBtn" class="header-logout" aria-label="Logout" title="Logout">Logout</button>
          <div class="header-logo">
            <img src="assets/logo.png" alt="DripCheck Logo" class="logo">
            <h1>DripCheck</h1>
          </div>
          <button id="btn" class="off header-toggle" aria-label="Toggle extension" title="Turn On">‚èª</button>
        </div>
        <p class="subtitle" style="text-align:center;">AI-powered Clothes/Accessories Try On</p>
        <div id="statusInfo" class="status-text"></div>
      </div>

          <!-- Authentication Section -->
          <div id="authSection" class="hidden">
            <div class="user-info">
              <h3>Welcome, <span id="userName"></span>!</h3>
              <div class="tokens">
                Tokens: <span id="tokenCount">0</span>
                <button id="refreshBtn" class="refresh-btn" title="Refresh token count">üîÑ</button>
              </div>
            </div>
          </div>

      <!-- Login/Register Section -->
      <div id="loginSection" class="section">
        <div class="section-title">Account</div>
        <div class="btn-group">
          <button id="googleSignInBtn" class="btn btn-primary" style="width:100%">Continue with Google</button>
        </div>
        <div id="authError" class="error-message hidden"></div>
      </div>

      <!-- Main Extension Section -->
      <div id="mainSection" class="hidden">
        <!-- Controls Row -->
        <div class="controls-row">
              <!-- Upload Image -->
              <div class="section full-width">
                <div class="section-title">Upload Image</div>
                
                <!-- Side-by-side previews -->
                <div id="previewsRow" class="controls-row single-preview">
                  <div>
                    <div class="image-preview">
                      <button id="clearImagesBtn" class="clear-btn" title="Clear images">‚úï</button>
                      <img id="imgPreview" alt="No image selected" />
                    </div>
                    <div id="previewInfo" class="status-text"></div>
                  </div>
                </div>

                
                
                <!-- Item Type Override (kept visually close to image) -->
                <div class="item-type-section">
                  <label for="itemTypeInput" class="item-type-label">Optional: What item in this image?</label>
                  <input id="itemTypeInput" type="text" placeholder="e.g. complete outfit, shirt, pants, shoes, hat" class="item-type-input">
                  <div class="item-type-help">This helps target the specific item to replace in your uploaded image.</div>
                </div>

                <div class="file-input-wrapper">
                  <input id="file" type="file" accept="image/*">
                  <label for="file" class="file-input-label" id="fileLabel">
                    üìÅ Choose Image File
                  </label>
                </div>
              </div>
        </div>
        
        <!-- Coupon Section -->
          <div id="couponSection" class="section hidden">
            <div class="section-title">Redeem Coupon</div>
            <div class="coupon-input-group">
              <input id="couponInput" type="text" placeholder="Enter coupon code">
              <button id="redeemBtn" class="btn btn-success">Redeem</button>
            </div>
            <div id="couponMessage" class="coupon-message"></div>
          </div>

          <!-- Feedback Section -->
          <div id="feedbackSection" class="section hidden">
            <div class="section-title">Questions or Suggestions</div>
            <div class="form-group">
              <select id="feedbackType">
                <option value="question">Question</option>
                <option value="suggestion">Suggestion</option>
                <option value="bug">Bug</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <textarea id="feedbackMessage" placeholder="Write your message..." style="width:100%; min-height: 80px; padding:12px; border:1px solid #d1d5db; border-radius:8px; font-family: inherit;"></textarea>
            </div>
            <div class="btn-group">
              <button id="sendFeedbackBtn" class="btn btn-success">Send</button>
            </div>
            <div id="feedbackAlert" class="coupon-message"></div>
          </div>

          <!-- Legal Links Section -->
          <div class="section" style="text-align: center; padding: 12px;">
            <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
              <a href="#" id="privacyPolicyLink" style="color: #3b82f6; text-decoration: none; margin-right: 16px;">Privacy Policy</a>
              <a href="#" id="termsOfServiceLink" style="color: #3b82f6; text-decoration: none;">Terms of Service</a>
            </div>
          </div>
            </div>
          </div>
          
          
        </div>
        <script src="config.js"></script>
        <script src="popup.js"></script>
  </body>
</html>


